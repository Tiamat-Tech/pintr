import{i as e,c as t}from"./vendor.d7bea3fb.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,a)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const c=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){a(new Error(`Failed to import: ${e}`)),r(l)},onload(){n(self[t].moduleMap[i]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("https://javier.xyz/pintr/assets/");const n=.399,o=.587-.05,r=.064;function a(e,t,n,o){let r=0,a=0,i=0;const c=e[0],l=t[0]-e[0],s=e[1],d=t[1]-e[1];let u=1;for(let m=0;m<1024;m++){const e=Math.round(c+l/1024*m),t=Math.round(s+d/1024*m),o=n[e][t],f=m/1024+1;u+=f,r+=o.r+f,a+=o.g+f,i+=o.b+f}return o?(r+a+i)/(765*u):[Math.round(r/u),Math.round(a/u),Math.round(i/u)]}function i(e){return e.beginPath(),{line:function(t,n,o={}){const{color:r="#000",width:a=1}=o;e.beginPath(),e.lineWidth=a,e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1]),e.strokeStyle=r,e.stroke()},lineBuffer:function(t,n,o={}){e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1])},stroke:function(t={}){const{color:n="#000",width:o=1}=t;e.lineWidth=o,e.strokeStyle=n,e.stroke(),e.beginPath()}}}window.IMAGE_SRC="./test.jpg",window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[];const c={singleLine:!0,baseLineNumber:5e3,updateSampleRate:256,addColor:"#000",substractionColor:"rgba(255,255,255,30%)",precisionRange:[16,28]},l=JSON.parse(JSON.stringify(c)),s=document.querySelector("canvas#src"),d=document.querySelector("canvas#draw");d.width=1080,d.height=1080;const u=d.getContext("2d"),m=i(u),f={matrix:[]};function h(e,t,n={}){const{color:o="#0008",close:r=!1,shiftY:a=0}=n;e.beginPath(),e.lineWidth=23,e.moveTo(t[0]._x,t[0]._y+a);for(const i of t)e.lineTo(i._x,i._y+a);r&&e.lineTo(t[0]._x,t[0]._y+a),e.strokeStyle=o,e.stroke()}async function w(c){window.CURRENT_DRAWING=(new Date).getTime(),window.COORDS=[],u.fillStyle="#fff",u.fillRect(0,0,1080,1080),document.querySelector("#srcimg").style.backgroundImage=`url("${c}")`;const d=await e(c,{size:1080,canvas:s}),{canvasData:w,averageLightness:g}=function(e){let t=e.data,a=1/0,i=0,c=0;for(let s=0;s<t.length;s+=4){let e=t[s]*n+t[s+1]*o+t[s+2]*r;a=Math.min(a,e),i=Math.max(i,e),c+=e}c=Math.round(c/(t.length/4)),a+=32,i-=32;const l=255/(i-a);for(let s=0;s<t.length;s+=4){let e=t[s]*n+t[s+1]*o+t[s+2]*r;t[s]=Math.round(e*l)-a,t[s+1]=Math.round(e*l)-a,t[s+2]=Math.round(e*l)-a}return{canvasData:e,averageLightness:c}}(d);d.ctx.putImageData(w,0,0);try{await async function(e,t){await faceapi.nets.ssdMobilenetv1.loadFromUri("/weights"),await faceapi.nets.faceLandmark68TinyNet.loadFromUri("/weights");const n=await faceapi.detectSingleFace(e).withFaceLandmarks(!0);if(!n)return;const o=n.landmarks.getRightEye(),r=n.landmarks.getLeftEye(),a=n.landmarks.getJawOutline();h(t,o,{close:!0}),h(t,r,{close:!0}),h(t,a.slice(2,-2),{color:"#0004",shiftY:10})}(s,d.ctx)}catch(S){console.warn("no face")}document.querySelector(".loading").style.display="none";const p=d.ctx;f.matrix=t(p);const y=i(d.ctx);let R=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];for(;f.matrix[R[0]][R[1]].r+f.matrix[R[0]][R[1]].g+f.matrix[R[0]][R[1]].b===765;)R=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];function M(){let e=R,t=l.singleLine?0:2*l.precisionRange[0];for(;t--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];f.matrix[e[0]][e[1]].r+f.matrix[e[0]][e[1]].g+f.matrix[e[0]][e[1]].b>f.matrix[t[0]][t[1]].r+f.matrix[t[0]][t[1]].g+f.matrix[t[0]][t[1]].b&&(e=t)}let n,o=function(e,t){return Math.min(e,t)+Math.floor(Math.random()*Math.abs(e-t))}(...l.precisionRange),r=1;for(;o--;){let t=[Math.floor(1080*Math.random()),Math.floor(1080*Math.random())];const o=a(e,t,f.matrix,!0);o<=r&&(r=o,n=t)}r=a(e,n,f.matrix,!0),window.COORDS.push([e,n]),m.lineBuffer(e,n,{color:"#000"}),y.lineBuffer(e,n,{color:l.substractionColor}),R=n}let b=Math.floor(l.baseLineNumber/g*128);function v(e){return new Promise((n=>{const o=(new Date).getTime();for(;(new Date).getTime()<o+15&&b-- >0;){if(e!==window.CURRENT_DRAWING)return;b%l.updateSampleRate==0&&(m.stroke({color:l.addColor}),y.stroke({color:l.substractionColor,width:1.5}),f.matrix=t(p)),M()}m.stroke({color:l.addColor}),y.stroke({color:l.substractionColor,width:1.5}),window.requestAnimationFrame(n)}))}!async function(e){for((new Date).getTime();b>0&&e===window.CURRENT_DRAWING;)await v(e)}(window.CURRENT_DRAWING)}function g(){const e=document.querySelector("input[type='range']#lines").value,t=document.querySelector("input[type='range']#singleline").value,n=document.querySelector("input[type='range']#contrast").value,o=document.querySelector("input[type='range']#definition").value;l.baseLineNumber=c.baseLineNumber/50*e,l.substractionColor=`rgba(255, 255, 255, ${100-n}%)`,l.precisionRange=[o,2*o],l.singleLine=!!Number(t),w(window.IMAGE_SRC)}w(window.IMAGE_SRC),document.querySelector("#inp").addEventListener("change",(function(){if(this.files&&this.files[0]){const e=new FileReader;e.addEventListener("load",(function(e){window.IMAGE_SRC=e.target.result,w(window.IMAGE_SRC)})),e.readAsDataURL(this.files[0])}})),document.querySelector("#inputbutton").addEventListener("click",(e=>{document.querySelector("#inp").click()})),document.querySelectorAll("input[type='range']").forEach((e=>{e.addEventListener("change",function(e,t){let n;return function(){clearTimeout(n);let o=arguments;n=setTimeout((function(){e.apply(this,o)}),t||1)}}(g,256))})),document.querySelector("#download").addEventListener("click",(e=>{const t=document.createElement("a");t.download="PINTR.png",t.href=document.querySelector("canvas#draw").toDataURL(),t.click()})),document.querySelector("#downloadsvg").addEventListener("click",(e=>{const t=document.createElement("a");t.download="PINTR.svg";const n=`<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">\n  <polyline points="${window.COORDS.map((e=>e[0].join(","))).join(" ")}" fill="none" stroke="black" />\n</svg>\n  `,o=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(o);t.href=r,t.click()}));
